<!-- Contenedor principal -->
<div class="page-container">
  
  <!-- Encabezado con información del catálogo -->
  <div class="content-section">
    <mat-card class="card-gradient">
      <mat-card-header>
        <div mat-card-avatar>
          <mat-icon>admin_panel_settings</mat-icon>
        </div>
        <mat-card-title>🔐 Catálogo de Perfiles</mat-card-title>
        <mat-card-subtitle>Administración y gestión de perfiles de usuario del sistema</mat-card-subtitle>
      </mat-card-header>
    </mat-card>
  </div>

  <!-- Barra de herramientas -->
  <div class="content-section">
    <mat-card class="card-standard">
      <div class="toolbar-content">
        <!-- Buscador -->
        <mat-form-field appearance="outline" class="search-field">
          <mat-label>Buscar perfiles</mat-label>
          <input matInput 
                 [(ngModel)]="searchTerm"
                 (input)="applyFilter()"
                 placeholder="Nombre del perfil..."
                 autocomplete="off">
          <mat-icon matSuffix>search</mat-icon>
        </mat-form-field>

        <!-- Botón Nuevo Perfil -->
        <button mat-raised-button 
                color="primary" 
                (click)="abrirDialogNuevoPerfil()"
                class="action-button">
          <mat-icon>add</mat-icon>
          Nuevo Perfil
        </button>
      </div>
    </mat-card>
  </div>

  <!-- Contenido principal -->
  <div class="content-section">
    @if (loading) {
      <div class="loading-container">
        <mat-spinner diameter="50"></mat-spinner>
        <p>Cargando perfiles...</p>
      </div>
    } @else {
      @if (showForm) {
        <!-- Formulario de creación/edición -->
        <mat-card class="card-standard">
          <mat-card-header>
            <mat-card-title>
              @if (isEditing) {
                <mat-icon>edit</mat-icon>
                Editar Perfil
              } @else {
                <mat-icon>add</mat-icon>
                Nuevo Perfil
              }
            </mat-card-title>
          </mat-card-header>
          
          <mat-card-content>
            <form [formGroup]="perfilForm" (ngSubmit)="savePerfil()">
              <div class="form-row">
                <mat-form-field appearance="outline" class="form-field">
                  <mat-label>Nombre del Perfil</mat-label>
                  <input matInput 
                         formControlName="perfil"
                         placeholder="Ej: Administrador, Cliente, Supervisor">
                  @if (perfilForm.get('perfil')?.hasError('required') && perfilForm.get('perfil')?.touched) {
                    <mat-error>El nombre del perfil es requerido</mat-error>
                  }
                </mat-form-field>

                <mat-form-field appearance="outline" class="form-field">
                  <mat-label>Descripción</mat-label>
                  <textarea matInput 
                           formControlName="descripcion"
                           placeholder="Descripción del perfil"
                           rows="3"></textarea>
                </mat-form-field>
              </div>

              <div class="form-actions">
                <button type="button" 
                        mat-stroked-button 
                        (click)="cancelarEdicion()"
                        class="cancel-button">
                  <mat-icon>cancel</mat-icon>
                  Cancelar
                </button>
                
                <button type="submit" 
                        mat-raised-button 
                        color="primary"
                        [disabled]="perfilForm.invalid || loading"
                        class="save-button">
                  <mat-icon>save</mat-icon>
                  @if (isEditing) {
                    Actualizar
                  } @else {
                    Guardar
                  }
                </button>
              </div>
            </form>
          </mat-card-content>
        </mat-card>
      } @else {
        <!-- Tabla de perfiles -->
        <mat-card class="card-standard">
          @if (dataSource.data.length > 0) {
            <div class="table-container">
              <table mat-table [dataSource]="dataSource" class="data-table" matSort>
                
                <!-- Columna ID -->
                <ng-container matColumnDef="perfilId">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header class="id-column">ID</th>
                  <td mat-cell *matCellDef="let perfil" class="id-column">{{ perfil.perfilId }}</td>
                </ng-container>

                <!-- Columna Perfil -->
                <ng-container matColumnDef="perfil">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header>Perfil</th>
                  <td mat-cell *matCellDef="let perfil">
                    <div class="user-info">
                      <span class="user-name">{{ perfil.perfil }}</span>
                    </div>
                  </td>
                </ng-container>

                <!-- Columna Descripción -->
                <ng-container matColumnDef="descripcion">
                  <th mat-header-cell *matHeaderCellDef mat-sort-header>Descripción</th>
                  <td mat-cell *matCellDef="let perfil">
                    <span class="description-text">{{ perfil.descripcion || 'Sin descripción' }}</span>
                  </td>
                </ng-container>

                <!-- Columna Acciones -->
                <ng-container matColumnDef="acciones">
                  <th mat-header-cell *matHeaderCellDef class="actions-column">Acciones</th>
                  <td mat-cell *matCellDef="let perfil" class="actions-column">
                    <button mat-icon-button 
                            [matMenuTriggerFor]="menuAcciones" 
                            color="primary"
                            matTooltip="Más opciones">
                      <mat-icon>more_vert</mat-icon>
                    </button>
                    
                    <mat-menu #menuAcciones="matMenu">
                      <button mat-menu-item (click)="editarPerfil(perfil)">
                        <mat-icon>edit</mat-icon>
                        <span>Editar</span>
                      </button>
                      
                      <button mat-menu-item (click)="verDetalles(perfil)">
                        <mat-icon>visibility</mat-icon>
                        <span>Ver detalles</span>
                      </button>
                      
                      <mat-divider></mat-divider>
                      
                      <button mat-menu-item 
                              (click)="eliminarPerfil(perfil)"
                              class="delete-action">
                        <mat-icon>delete</mat-icon>
                        <span>Eliminar</span>
                      </button>
                    </mat-menu>
                  </td>
                </ng-container>

                <!-- Filas de la tabla -->
                <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns;" 
                    class="table-row"></tr>
              </table>

              <!-- Paginador -->
              <mat-paginator #paginator
                           [length]="dataSource.data.length"
                           [pageSize]="pageSize"
                           [pageSizeOptions]="pageSizeOptions"
                           showFirstLastButtons
                           class="paginator">
              </mat-paginator>
            </div>
          } @else {
            <!-- Estado vacío -->
            <div class="empty-state">
              <mat-icon class="empty-icon">admin_panel_settings</mat-icon>
              <h3>No hay perfiles registrados</h3>
              <p>Comienza creando el primer perfil del sistema para asignar roles y permisos a los usuarios.</p>
              <button mat-raised-button 
                      color="primary" 
                      (click)="abrirDialogNuevoPerfil()"
                      class="empty-action-button">
                <mat-icon>add</mat-icon>
                Crear Primer Perfil
              </button>
            </div>
          }
        </mat-card>
      }
    }
  </div>
</div>
